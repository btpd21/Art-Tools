<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Botanical Collage Layer Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="app.css" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0b1220" />
</head>
<body>
  <a class="skip" href="#main">Skip to canvas</a>

  <header class="ribbon" id="ribbon" role="banner" data-mode="show" data-locked="false">
    <div class="ribbon-row">
      <div class="ribbon-left" role="toolbar" aria-label="Collage actions">
        <button class="btn primary" data-action="generate" title="Generate (G)">Generate</button>
        <button class="btn" data-action="shuffle" title="Shuffle (S)">Shuffle</button>
        <button class="btn" data-action="export" title="Export PNG (E)">Export</button>
        <button class="btn" data-action="exportJSON" title="Export JSON">Export JSON</button>
        <button class="btn" data-action="batch" title="Batch x10 (B)">Batch x10</button>
        <div class="divider" aria-hidden="true"></div>
        <div class="status" id="status" role="status" aria-live="polite">idle</div>
      </div>
      <div class="ribbon-right">
        <span class="badge lock-badge" id="ribbonLockBadge" aria-hidden="true">Locked</span>
        <div class="dropdown">
          <button id="ribbonMenuBtn" aria-haspopup="true" aria-expanded="false" aria-controls="ribbonMenu">Ribbon ▾</button>
          <div id="ribbonMenu" class="menu" role="menu" aria-labelledby="ribbonMenuBtn">
            <button role="menuitemradio" data-mode="show" aria-checked="true">Show</button>
            <button role="menuitemradio" data-mode="auto" aria-checked="false">Auto-hide</button>
            <button role="menuitemradio" data-mode="compact" aria-checked="false">Compact</button>
            <hr />
            <button role="menuitemcheckbox" id="lockToggle" aria-checked="false">Lock ribbon</button>
            <hr />
            <button id="toggleContrast" role="menuitemcheckbox" aria-checked="false">High contrast</button>
            <button id="toggleMotion" role="menuitemcheckbox" aria-checked="false">Reduced motion</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap" id="main">
    <nav class="sidebar" aria-label="Parameters">
      <h2 class="title">Settings</h2>

      <fieldset class="group">
        <legend>Photos</legend>
        <input id="file" type="file" accept="image/*" multiple />
        <p class="hint">Drop or choose images. Processing stays on your device.</p>
        <div class="images" id="images"></div>
      </fieldset>

      <fieldset class="group">
        <legend>Canvas & Seed</legend>
        <label class="param"><span>Width</span><input id="w" type="number" min="256" max="12000" value="3000" /></label>
        <label class="param"><span>Height</span><input id="h" type="number" min="256" max="12000" value="2000" /></label>
        <label class="param"><span>Seed</span><input id="seed" type="number" placeholder="optional" /></label>
        <label class="param"><span>DPI label</span><input id="dpiLabel" type="text" placeholder="e.g., 300 dpi (label only)" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Negative Space & Limits</legend>
        <label class="param"><span>Negative Space %</span><input id="negSpace" type="range" min="10" max="70" value="35" /></label>
        <label class="param"><span>Max Element %</span><input id="maxElem" type="range" min="5" max="30" value="22" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Tiles</legend>
        <label class="param"><span>Tile Count</span><input id="tileCount" type="range" min="42" max="96" value="60" /></label>
        <label class="param"><span>Special %</span><input id="specialPct" type="range" min="10" max="60" value="28" /></label>
        <label class="param"><span>Size Mean %</span><input id="sizeMean" type="range" min="1" max="6" value="3" /></label>
        <label class="param"><span>Size Spread %</span><input id="sizeSpread" type="range" min="1" max="8" value="3" /></label>
        <label class="param"><span>Rot range °</span><input id="rotRange" type="range" min="5" max="75" value="35" /></label>
        <label class="param"><span>Skew range °</span><input id="skewRange" type="range" min="0" max="20" value="8" /></label>
        <div class="toggle-row">
          <label class="toggle"><input id="allowRect" type="checkbox" checked />Rectangles</label>
          <label class="toggle"><input id="allowScissor" type="checkbox" checked />Scissor-cut</label>
          <label class="toggle"><input id="allowTorn" type="checkbox" checked />Torn</label>
        </div>
        <label class="param"><span>Scissor Jaggedness</span><input id="scissorJag" type="range" min="0" max="100" value="45" /></label>
        <label class="param"><span>Torn Roughness</span><input id="tornRough" type="range" min="0" max="100" value="55" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Strips</legend>
        <label class="param"><span>Count</span><input id="stripCount" type="range" min="0" max="20" value="7" /></label>
        <label class="param"><span>Thickness %</span><input id="stripThick" type="range" min="1" max="15" value="4" /></label>
        <label class="param"><span>Opacity %</span><input id="stripOpacity" type="range" min="76" max="100" value="88" /></label>
        <label class="param"><span>Angle min from 0/90</span><input id="angleMin" type="range" min="10" max="30" value="18" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Clusters</legend>
        <label class="param"><span>Count</span><input id="clusterCount" type="range" min="0" max="9" value="3" /></label>
        <label class="param"><span>Tiles per Cluster</span><input id="clusterTiles" type="range" min="5" max="17" value="9" /></label>
        <label class="param"><span>Opacity %</span><input id="clusterOpacity" type="range" min="76" max="100" value="90" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Easter Eggs</legend>
        <label class="param"><span>Count</span><input id="eggCount" type="range" min="0" max="7" value="3" /></label>
        <label class="param"><span>Max Size %</span><input id="eggSize" type="range" min="0.2" max="3" step="0.1" value="1" /></label>
      </fieldset>

      <div class="group row">
        <span class="kbdhint">Shortcuts: G Generate · S Shuffle · E Export</span>
      </div>
    </nav>

    <section class="stage">
      <div class="canvas-bar">
        <span>Preview</span>
        <div class="canvas-actions">
          <button class="btn small" data-action="fit">Fit</button>
          <button class="btn small" data-action="1x">100%</button>
        </div>
      </div>
      <div class="canvas-wrap">
        <canvas id="c" aria-label="Collage canvas" role="img"></canvas>
      </div>
      <div class="canvas-footer">
        <span id="meta"></span>
      </div>
    </section>
  </div>

  <script src="app.js"></script>
  <script src="collage.js"></script>
  <script>
    // Register service worker if present
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
