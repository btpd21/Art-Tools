<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Collage Tool</title>
  <link rel="stylesheet" href="app.css" />
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.webmanifest" />
</head>
<body>
  <a class="skip" href="#canvasRegion">Skip to canvas</a>

  <header class="ribbon" id="ribbon" role="banner">
    <div class="ribbon-row">
      <div class="ribbon-left" role="toolbar" aria-label="Collage actions">
        <button class="btn primary" data-action="generate" title="Generate (G)">Generate</button>
        <button class="btn" data-action="shuffle" title="Shuffle (S)">Shuffle</button>
        <button class="btn" data-action="export" title="Export PNG (E)">Export</button>
        <button class="btn" data-action="exportJSON" title="Export JSON">Export JSON</button>
        <button class="btn" data-action="batch" title="Batch Export (B)">Batch</button>
      </div>
      <div class="ribbon-right">
        <span id="status" class="status">idle</span>
        <div class="dropdown">
          <button id="ribbonMenuBtn" aria-haspopup="true" aria-expanded="false" title="Menu">☰</button>
          <div class="menu" id="ribbonMenu" role="menu">
            <button role="menuitemradio" data-mode="show" aria-checked="true">Show ribbon</button>
            <button role="menuitemradio" data-mode="auto" aria-checked="false">Auto-hide ribbon</button>
            <button role="menuitemradio" data-mode="compact" aria-checked="false">Compact ribbon</button>
            <hr/>
            <label class="toggle"><input type="checkbox" id="toggleContrast" /> High contrast</label>
            <label class="toggle"><input type="checkbox" id="toggleMotion" /> Reduce motion</label>
            <hr/>
            <button id="lockToggle" aria-checked="false">Lock ribbon</button>
          </div>
        </div>
        <span class="lock-badge" id="ribbonLockBadge">Locked</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <aside class="sidebar">
      <h1 class="title">Collage Tool</h1>
      <div class="group">
        <label>Photos:
          <input type="file" id="file" multiple accept="image/*">
        </label>
        <div class="images" id="images"></div>
      </div>

      <fieldset class="group">
        <legend>Canvas</legend>
        <label class="param"><span>Width</span><input id="w" type="number" min="64" max="8000" step="16" value="1600" /></label>
        <label class="param"><span>Height</span><input id="h" type="number" min="64" max="8000" step="16" value="1000" /></label>
        <label class="param"><span>Seed</span><input id="seed" type="number" min="0" max="999999999" placeholder="random" /></label>
        <label class="param"><span>DPI Label</span><input id="dpiLabel" type="text" maxlength="16" placeholder="e.g. hi-res" /></label>
        <label class="param"><span>Negative Space (0–100)</span><input id="negSpace" type="number" min="0" max="100" step="1" value="35" /></label>
        <label class="param"><span>Max Element % of canvas</span><input id="maxElem" type="number" min="1" max="30" step="0.5" value="18" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Tiles</legend>
        <label class="param"><span>Tile Count</span><input id="tileCount" type="number" min="1" max="500" step="1" value="90" /></label>
        <label class="param"><span>% Special</span><input id="specialPct" type="number" min="0" max="100" step="1" value="35" /></label>

        <label class="param"><span>Tile Min Size (0–100)</span><input id="tileMin" type="number" min="0" max="100" step="0.5" value="2" /></label>
        <label class="param"><span>Tile Max Size (0–100)</span><input id="tileMax" type="number" min="0" max="100" step="0.5" value="12" /></label>

        <label class="param"><span>Rotation Range (°)</span><input id="rotRange" type="number" min="0" max="180" step="1" value="40" /></label>
        <label class="param"><span>Skew Range (°)</span><input id="skewRange" type="number" min="0" max="60" step="1" value="10" /></label>
        <label class="param"><span>Texture Rotation (°)</span><input id="imgRotRange" type="number" min="0" max="180" step="1" value="15" /></label>
        <label class="param"><span>Sampling Diversity (0–100)</span><input id="diversity" type="number" min="0" max="100" step="1" value="75" /></label>

        <div class="toggle-row">
          <label class="toggle"><input id="allowRect" type="checkbox" checked />Rect</label>
          <label class="toggle"><input id="allowScissor" type="checkbox" checked />Scissor</label>
          <label class="toggle"><input id="allowTorn" type="checkbox" checked />Torn</label>
          <label class="toggle"><input id="allowEllipse" type="checkbox" />Ellipse</label>
          <label class="toggle"><input id="allowTriangle" type="checkbox" />Triangle</label>
          <label class="toggle"><input id="allowDiamond" type="checkbox" />Diamond</label>
          <label class="toggle"><input id="allowHex" type="checkbox" />Hex</label>
        </div>
        <label class="param"><span>Scissor Jag (0–100)</span><input id="scissorJag" type="number" min="0" max="100" step="1" value="45" /></label>
        <label class="param"><span>Torn Rough (0–100)</span><input id="tornRough" type="number" min="0" max="100" step="1" value="65" /></label>
        <label class="param"><span>Edge Contrast (0–100)</span><input id="edgeContrast" type="number" min="0" max="100" step="1" value="35" /></label>
        <label class="param"><span>Shape Irregularity (0–100)</span><input id="irregular" type="number" min="0" max="100" step="1" value="30" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Strips (background)</legend>
        <label class="param"><span>Count</span><input id="stripCount" type="number" min="0" max="20" step="1" value="2" /></label>
        <label class="param"><span>Thickness (0–100 ⇒ 0–10%)</span><input id="stripThick" type="number" min="0" max="100" step="1" value="40" /></label>
        <label class="param"><span>Opacity (0–100)</span><input id="stripOpacity" type="number" min="0" max="100" step="1" value="86" /></label>
        <label class="param"><span>Min Angle (°)</span><input id="angleMin" type="number" min="0" max="45" step="1" value="8" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Clusters</legend>
        <label class="param"><span>Cluster Count</span><input id="clusterCount" type="number" min="0" max="12" step="1" value="1" /></label>
        <label class="param"><span>Tiles per Cluster</span><input id="clusterTiles" type="number" min="1" max="30" step="1" value="4" /></label>
        <label class="param"><span>Opacity (0–100)</span><input id="clusterOpacity" type="number" min="0" max="100" step="1" value="88" /></label>
        <label class="param"><span>Cluster Min Tile (0–100)</span><input id="clusterTileMin" type="number" min="0" max="100" step="0.5" value="1.5" /></label>
        <label class="param"><span>Cluster Max Tile (0–100)</span><input id="clusterTileMax" type="number" min="0" max="100" step="0.5" value="6" /></label>
        <label class="param"><span>Layer Randomness (0–100)</span><input id="clusterLayerRnd" type="number" min="0" max="100" step="1" value="60" /></label>
      </fieldset>

      <fieldset class="group">
        <legend>Easter Eggs</legend>
        <label class="param"><span>Count</span><input id="eggCount" type="number" min="0" max="10" step="1" value="0" /></label>
        <label class="param"><span>Max Size (%)</span><input id="eggSize" type="number" min="1" max="40" step="1" value="12" /></label>
      </fieldset>
    </aside>

    <section class="stage">
      <div class="canvas-bar">
        <span id="meta">No render yet.</span>
        <div class="canvas-actions">
          <button class="btn small" data-action="fit" title="Fit Canvas">Fit</button>
          <button class="btn small" data-action="1x" title="1x Zoom">1x</button>
        </div>
      </div>
      <div class="canvas-wrap" id="canvasRegion">
        <canvas id="c" width="1600" height="1000" tabindex="0" aria-label="Collage canvas"></canvas>
      </div>
      <div class="canvas-footer">
        <span class="kbdhint">Shortcuts: G = Generate, S = Shuffle, E = Export, B = Batch</span>
      </div>
    </section>
  </main>

  <script src="collage.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.
    }
  </script>
  <!-- Hotfix override loader: loads hotfix/override.js if present -->
  <script>
  (function(){
    fetch("hotfix/override.js", {cache:"no-store"})
      .then(r => r.ok ? r.text() : null)
      .then(code => {
        if (!code) return;
        const s = document.createElement("script");
        s.type = "module";
        s.textContent = code;
        document.body.appendChild(s);
        console.log("[Hotfix] override loaded");
      })
      .catch(()=>{});
  })();
  </script>
</body>
</html>
<script>(function(){try{
<!-- SLIDER-PAIR-HOTFIX-START -->
<script src="./features.js?v=1754773661-170733"></script>
<script src="./sliders.js?v=1754773661-170733"></script>
